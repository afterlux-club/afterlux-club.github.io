<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-RN07E4K7GL"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-RN07E4K7GL');
</script>
<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Afterlux Club — Events & Reservierungen</title>
  <link rel="icon" type="image/png" href="afterluxluna.png" />

  <meta name="color-scheme" content="dark" />
  <style>
    :root{
      --gold:#FFD700; --gold-d:#e6c200;
      --text:#fff; --muted:#bbbbbb;
      --card:rgba(255,255,255,.06);
      --border:rgba(255,215,0,.28);
      --radius:16px;
    }
    *{box-sizing:border-box}
    html,body{margin:0}
    body{
      font-family: Helvetica, Arial, sans-serif;
      color:var(--text);
      background:
        linear-gradient(rgba(0,0,0,.62), rgba(0,0,0,.72)),
        url("sfondo%20web.png") center/cover fixed no-repeat #000;
      min-height:100vh;
      line-height:1.45;
    }
    a{color:var(--gold);text-decoration:none}
    a:hover{text-decoration:underline}
    header, section, footer{padding:22px}
    h1,h2,h3{color:var(--gold);margin:0 0 12px}
    .container{max-width:1100px;margin:0 auto}

    /* LOGO */
    .logo{display:flex;justify-content:center;align-items:center;margin:4px 0 8px}
    .logo img{height:clamp(140px,22vw,360px);max-width:100%;display:block}

    /* NAV */
    nav{display:flex;gap:14px;flex-wrap:wrap;justify-content:center;margin-bottom:18px}
    nav a{padding:8px 12px;border-radius:12px;border:1px solid transparent}
    nav a:hover{background:var(--card);border-color:var(--border)}

    /* BTN */
    .btn{display:inline-block;background:var(--gold);color:#000;padding:10px 16px;border-radius:12px;border:none;font-weight:700;cursor:pointer}
    .btn:hover{background:var(--gold-d)}
    .ghost{background:transparent;color:var(--gold);border:1px solid var(--border)}

    /* CARDS */
    .cards{display:grid;gap:18px;grid-template-columns:repeat(auto-fit,minmax(260px,1fr))}
    .card{background:var(--card);border:1px solid var(--border);border-radius:var(--radius);overflow:hidden}
    .card img,.card video{
      width:100%;
      height:clamp(220px,32vw,420px);
      object-fit:cover;
      display:block;
      background:#000;
    }
    .card .content{padding:14px}
    .pill{display:inline-block;padding:4px 10px;border-radius:999px;background:rgba(255,255,255,.1);font-size:12px;margin-bottom:8px}
    .muted{color:var(--muted)}

    /* MAP */
    .map{width:100%;height:300px;border:0;border-radius:12px}

    /* OVERLAY / MODALS */
    .overlay{position:fixed;inset:0;background:rgba(0,0,0,.72);display:none;align-items:center;justify-content:center;padding:16px;z-index:50}
    .overlay.show{display:flex}
    .modal{max-width:900px;width:100%;background:#0a0a0a;border:1px solid var(--border);border-radius:16px;overflow:hidden}
    .modal-head,.modal-foot{padding:12px 14px;border-bottom:1px solid var(--border)}
    .modal-foot{border-top:1px solid var(--border);border-bottom:none;display:flex;justify-content:flex-end;gap:10px;flex-wrap:wrap}
    .modal-body{display:grid;grid-template-columns:1fr 1fr;gap:14px;padding:14px}
    .modal .cover{height:260px;background:#111 center/cover no-repeat;border:1px solid var(--border);border-radius:12px}
    @media (max-width:800px){.modal-body{grid-template-columns:1fr}}

    footer{border-top:1px solid var(--border);text-align:center;color:var(--muted);padding-bottom:28px}

    /* ACCORDION SECTIONS (chiuse di default) */
    .acc h2{
      display:flex;align-items:center;gap:10px;cursor:pointer;
    }
    .acc .chev{transition:transform .2s ease;display:inline-block}
    .acc .body{display:none;margin-top:12px}
    .acc[aria-expanded="true"] .body{display:block}
    .acc[aria-expanded="true"] .chev{transform:rotate(90deg)}

    /* Nascondi per sempre "Tickets" nel modal dettagli (resta esterno sulle card) */
    #buy-tickets{display:none !important;}
  </style>
</head>
<body>
  <header class="container">
    <div class="logo"><img src="afterluxluna.png" alt="Afterlux Club Logo" loading="eager" decoding="async"></div>
    <nav aria-label="Hauptnavigation">
      <a href="#contatti" data-open="contatti">Kontakt</a>
      <a href="#eventi" data-open="eventi">Events</a>
      <a href="#galleria" data-open="galleria">Galerie</a>
      <a href="#chi-siamo" data-open="chi-siamo">Über uns</a>
    </nav>
    <div id="countdown" class="container" hidden style="display:flex;gap:10px;justify-content:center;flex-wrap:wrap">
      <span class="pill"><b id="cd-d">--</b> Tage</span>
      <span class="pill"><b id="cd-h">--</b> Std</span>
      <span class="pill"><b id="cd-m">--</b> Min</span>
      <span class="pill"><b id="cd-s">--</b> Sek</span>
    </div>
  </header>

  <main class="container">
    <!-- K O N T A K T  (accordion) -->
    <section id="contatti" class="acc" aria-expanded="false">
      <h2 tabindex="0" aria-controls="contatti-body" aria-label="Kontakt öffnen/schließen">
        <span class="chev">▶</span> Kontakt
        <span class="muted" style="font-size:12px">(klicken zum Anzeigen)</span>
      </h2>
      <div id="contatti-body" class="body">
        <div class="cards">
          <div class="card"><div class="content">
            <p><strong>Telefon:</strong> <a href="tel:+4915738465393">+49 1573 8465393</a></p>
            <p><strong>E-Mail:</strong> <a href="mailto:afterlux.loerrach@gmail.com">afterlux.loerrach@gmail.com</a></p>
            <p><strong>Instagram:</strong> <a target="_blank" rel="noopener" href="https://www.instagram.com/afterlux_club?igsh=cWU0emo2ZHZyYjZp">@afterlux_club</a></p>
            <p><strong>Adresse:</strong> Teicherstrasse 14, 79539 Lörrach (DE)</p>
            <p class="muted">Öffnungszeiten: Mo–Mi geschlossen · Do 21:30–02:00 · Fr 23:00–05:00 · Sa 23:00–05:00 · So 14:00–18:00</p>
          </div></div>
          <div class="card">
            <iframe class="map" src="https://www.google.com/maps?q=Teicherstrasse%2014%2079539%20L%C3%B6rrach&output=embed" loading="lazy" allowfullscreen></iframe>
          </div>
        </div>
      </div>
    </section>

    <!-- E V E N T S  (accordion) -->
    <section id="eventi" class="acc" aria-expanded="false" style="margin-top:24px">
      <h2 tabindex="0" aria-controls="eventi-body" aria-label="Events öffnen/schließen">
        <span class="chev">▶</span> Events
      </h2>
      <div id="eventi-body" class="body">
        <!-- Suche + Filter -->
        <div class="card" style="padding:12px;display:flex;gap:10px;flex-wrap:wrap;margin-bottom:16px">
          <input id="q" placeholder="Suchen… (z.B. Latin, Halloween)" aria-label="Events suchen"
                 style="flex:1;min-width:200px;padding:10px;border-radius:10px;border:1px solid var(--border);background:#0b0b0b;color:#fff">
          <select id="month" aria-label="Nach Monat filtern"
                  style="padding:10px;border-radius:10px;border:1px solid var(--border);background:#0b0b0b;color:#fff">
            <option value="">Alle Monate</option>
          </select>
          <button class="btn ghost" type="button" id="clr">Zurücksetzen</button>
        </div>

        <div id="event-cards" class="cards"></div>

        <h3 style="margin-top:26px">Wiederkehrende Events</h3>
        <div id="recurring-cards" class="cards"></div>
      </div>
    </section>

    <!-- G A L E R I E  (accordion) -->
    <section id="galleria" class="acc" aria-expanded="false" style="margin-top:24px">
      <h2 tabindex="0" aria-controls="galleria-body" aria-label="Galerie öffnen/schließen">
        <span class="chev">▶</span> Galerie
      </h2>
      <div id="galleria-body" class="body">
        <img src="./Lounge-Afterlux.png" alt="Lounge-Plan Afterlux" loading="lazy"
             style="width:min(30%,520px);max-width:1000px;display:block;margin:0 auto 20px;border-radius:12px;box-shadow:0 0 20px rgba(255,215,0,.3)">
        <p style="color:#FFD700;text-align:center">Reserviere deine Lounge: N1–N5 jedes Wochenende verfügbar.</p>

        <!-- VIDEO CARD -->
        <div class="cards" style="margin-top:18px">
          <article class="card">
            <video controls playsinline preload="metadata" poster="afterluxluna.png" loading="lazy"
                   aria-label="Afterlux Club – Video Teaser">
              <source src="video%20afterlux%20.mp4" type="video/mp4">
            </video>
            <div class="content">
              <div class="pill">Highlight • Club Teaser</div>
              <h3>Afterlux – Video</h3>
              <p class="muted">Präsentation</p>
              <div style="margin-top:8px">
                <button class="btn" type="button" onclick="this.closest('.card').querySelector('video').play()">▶︎ Play</button>
                <button class="btn ghost" type="button" onclick="this.closest('.card').querySelector('video').pause()">⏸︎ Pause</button>
              </div>
            </div>
          </article>
        </div>

        <!-- PROMOTER -->
        <div class="promoter-section" style="text-align:center;margin-top:40px">
          <h3 style="color:#FFD700;font-size:1.8rem;margin-bottom:15px">Werde Afterlux Promoter</h3>
          <img src="./promoter.jpg" alt="Afterlux Club Promoter" loading="lazy"
               style="width:min(30%,520px);max-width:800px;display:block;margin:0 auto 20px;border-radius:12px;box-shadow:0 0 20px rgba(255,215,0,.3)">
          <p style="color:#FFD700;font-size:1rem;max-width:800px;margin:0 auto">
            Du willst Teil vom Afterlux-Team werden? Schreib uns auf Instagram oder per E-Mail und sichere dir exklusive Vorteile.
          </p><br>
          <a href="https://www.instagram.com/afterlux_club/" target="_blank" rel="noopener"
             style="background-color:#FFD700;color:#000;padding:10px 25px;border-radius:25px;text-decoration:none;font-weight:bold">
            Kontaktiere uns auf Instagram
          </a>
        </div>
      </div>
    </section>

    <!-- Ü B E R  U N S  (accordion) -->
    <section id="chi-siamo" class="acc" aria-expanded="false" style="margin-top:24px">
      <h2 tabindex="0" aria-controls="chi-siamo-body" aria-label="Über uns öffnen/schließen">
        <span class="chev">▶</span> Über uns
      </h2>
      <div id="chi-siamo-body" class="body">
        <p><strong>Afterlux Club</strong> ist die Vision zweier junger Partner: <strong>Giuseppe Leocata</strong> und <strong>Luana Ferlito</strong>.</p>
        <p>Unsere Mission: Wir bringen das Nachtleben in Lörrach nach vorn – mit einem Ort, an dem sich <em>alle</em> wohlfühlen. Bei uns laufen verschiedene Musikrichtungen, von House und Hip-Hop über Reggaeton bis Tech House, in einer offenen, inklusiven Atmosphäre.</p>
        <p>Mit Motto-Nights, Shows und neuen Formaten schaffen wir regelmäßig frische, einzigartige Erlebnisse – damit jede Nacht in Erinnerung bleibt.</p>
      </div>
    </section>
  </main>

  <!-- MODAL: DETTAGLI EVENTO (senza Tickets) -->
  <div id="event-detail" class="overlay" role="dialog" aria-modal="true" aria-labelledby="detail-title">
    <div class="modal">
      <div class="modal-head"><h3 id="detail-title" style="margin:0">Event-Details</h3></div>
      <div class="modal-body">
        <div id="detail-cover" class="cover" aria-label="Event-Cover"></div>
        <div>
          <div class="pill" id="detail-date">Datum</div>
          <h3 id="detail-name" style="margin:8px 0 6px">Titel</h3>
          <p class="muted" id="detail-desc">Beschreibung</p>
          <div style="margin-top:10px"><strong>Line-up</strong><div class="muted" id="detail-lineup">—</div></div>
          <div style="margin-top:10px"><strong>Info</strong><div class="muted" id="detail-prices">—</div></div>
        </div>
      </div>
      <div class="modal-foot">
        <button id="open-booking" class="btn" type="button">Jetzt reservieren</button>
        <button class="btn ghost" type="button" onclick="document.getElementById('event-detail').classList.remove('show')">Schließen</button>
      </div>
    </div>
  </div>

  <!-- MODAL: PRENOTAZIONI (apre SOLO al clic dalle card) -->
  <div id="prenotazioni" class="overlay" role="dialog" aria-modal="true" aria-labelledby="pr-title" style="display:none">
    <div class="modal" style="max-width:720px">
      <div class="modal-head"><h3 id="pr-title" style="margin:0">Reservieren</h3></div>
      <div class="modal-body" style="display:block">
        <p class="muted">Schreib uns direkt: Event & Lounge wählen und dann per WhatsApp oder E-Mail senden.</p>
        <div class="card" style="padding:16px;display:grid;gap:12px;border:none;background:transparent">
          <div style="display:grid;grid-template-columns:repeat(2,minmax(0,1fr));gap:12px">
            <label><div class="muted">Vor- und Nachname</div>
              <input id="pr-nome" type="text" placeholder="Dein Name"
                style="width:100%;padding:10px;border-radius:10px;border:1px solid var(--border);background:#0b0b0b;color:#fff">
            </label>
            <label><div class="muted">Telefon</div>
              <input id="pr-tel" type="tel" placeholder="+49 ..."
                style="width:100%;padding:10px;border-radius:10px;border:1px solid var(--border);background:#0b0b0b;color:#fff">
            </label>
          </div>

          <div style="display:grid;grid-template-columns:repeat(2,minmax(0,1fr));gap:12px">
            <label><div class="muted">E-Mail</div>
              <input id="pr-email" type="email" placeholder="name@email.com"
                style="width:100%;padding:10px;border-radius:10px;border:1px solid var(--border);background:#0b0b0b;color:#fff">
            </label>
            <label><div class="muted">Datum (bei datiertem Event)</div>
              <input id="pr-data" type="date"
                style="width:100%;padding:10px;border-radius:10px;border:1px solid var(--border);background:#0b0b0b;color:#fff">
            </label>
          </div>

          <div style="display:grid;grid-template-columns:repeat(3,minmax(0,1fr));gap:12px">
            <label><div class="muted">Event</div>
              <select id="pr-event" style="width:100%;padding:10px;border-radius:10px;border:1px solid var(--border);background:#0b0b0b;color:#fff">
                <option value="">— Event auswählen —</option>
              </select>
            </label>

            <label><div class="muted">Lounge</div>
              <select id="pr-lounge" style="width:100%;padding:10px;border-radius:10px;border:1px solid var(--border);background:#0b0b0b;color:#fff">
                <option>N0</option><option>N1</option><option>N2</option><option>N3</option><option>N4</option><option>N5</option>
              </select>
            </label>

            <label><div class="muted">Personen</div>
              <select id="pr-persone" style="width:100%;padding:10px;border-radius:10px;border:1px solid var(--border);background:#0b0b0b;color:#fff">
                <option>2</option><option>4</option><option>6</option><option>8</option><option>10</option>
              </select>
            </label>
          </div>

          <label><div class="muted">Notizen (optional)</div>
            <textarea id="pr-note" rows="3" placeholder="z. B. Geburtstag, Wünsche…"
              style="width:100%;padding:10px;border-radius:10px;border:1px solid var(--border);background:#0b0b0b;color:#fff"></textarea>
          </label>

          <div style="display:flex;gap:10px;flex-wrap:wrap">
            <button class="btn" type="button" id="btn-wa">Per WhatsApp senden</button>
            <button class="btn ghost" type="button" id="btn-mail">Per E-Mail senden</button>
            <a class="btn ghost" href="tel:+4915738465393">Anrufen</a>
          </div>
        </div>
      </div>
      <div class="modal-foot">
        <button class="btn ghost" type="button" onclick="document.getElementById('prenotazioni').classList.remove('show')">Schließen</button>
      </div>
    </div>
  </div>

  <footer><div class="container">© <span id="year"></span> Afterlux Club • Alle Rechte vorbehalten</div></footer>

  <script>
    document.getElementById('year').textContent = new Date().getFullYear();

    /* ====== DATI EVENTI ====== */
    const eventi = [
      { slug:'russian-beats-2025-10-11', name:'Russian Beats', dateISO:'2025-10-11T22:30:00+02:00', shortDate:'Sa 11 Okt', desc:'Beginn 22:30', lineup:'DJ Andy', prices:'—', cover:'serata russa 11.10.jpg' },
      { slug:'latin-night-2025-10-17', name:'Latin Night', dateISO:'2025-10-17T23:00:00+02:00', shortDate:'Fr 17 Okt', desc:'Start 23:00 • DJ Don-Maiky • Eintritt GRATIS', lineup:'DJ Don-Maiky', prices:'Eintritt GRATIS', cover:'Latin Night.jpg' },
      { slug:'rhythms-of-world-2025-10-18', name:'Rhythms of World', dateISO:'2025-10-18T23:00:00+02:00', shortDate:'Sa 18 Okt', desc:'Start 23:00', lineup:'David Costa', prices:'Eintritt GRATIS & ein GRATIS-SHOT', cover:'david costa 18.10.jpg' },
      { slug:'la-noche-brasilena-2025-10-25', name:'La noche brasileña', dateISO:'2025-10-25T23:00:00+02:00', shortDate:'Sa 25 Okt', desc:'Start 23:00', lineup:'Salese', prices:'Eintritt 5€ & ein GRATIS-SHOT', cover:'dj salese 25.10.jpg',
        ticketUrl:'https://eventfrog.de/de/p/party/disco/la-noche-brasilena-7381417087799956339.html' },
      { slug:'halloween-party-2025-10-31', name:'Halloween Party', dateISO:'2025-10-31T23:00:00+01:00', shortDate:'Fr 31 Okt', desc:'Latin Mix • Costume Contest', lineup:'DJ Pepe', prices:'Vorverkauf 5€ • Abendkasse 10€', cover:'hallowe 31.10.jpg',
        ticketUrl:'https://eventfrog.de/de/p/party/disco/halloween-party-7381430034773332317.html' },
      { slug:'last-school-day-2025-12-19', name:'Last School Day 2025 – Spendenparty Abi 2026 (FES)', dateISO:'2025-12-19T22:00:00+01:00', shortDate:'Fr 19 Dez', desc:'Spendenaktion des Abi-Jahrgangs 2026 der FES • Einlass 22:00', lineup:'—', prices:'Ticket 7€ • Mindestalter 16', cover:'Black Party Night Club Dj Flyer.png',
        ticketUrl:'https://eventfrog.de/de/p/party/disco/last-school-day-2025-7383798159095412970.html' }
    ];
    const recurring = [
      { slug:'karaoke-night', name:'Karaoke Night', when:'Jeden Donnerstag', time:'21:30 – 02:00', desc:'Eintritt frei • Die Bühne gehört dir!', lineup:'Open Mic • Host Afterlux', prices:'Free Entry', cover:'karaoke.jpg' },
    ];

    /* ====== HELPERS ====== */
    const $ = s => document.querySelector(s);
    const $$ = s => [...document.querySelectorAll(s)];

    /* ====== ACCORDION LOGIC (apri/chiudi, solo al clic) ====== */
    function setSectionOpen(id, open){
      const sec = document.getElementById(id);
      if(!sec) return;
      sec.setAttribute('aria-expanded', String(open));
      if(open) sec.scrollIntoView({behavior:'smooth',block:'start'});
    }
    // Toggle col titolo
    $$('.acc h2').forEach(h=>{
      h.addEventListener('click', ()=>{
        const sec = h.parentElement;
        const willOpen = sec.getAttribute('aria-expanded')!=='true';
        // chiudi le altre
        $$('.acc').forEach(s=>s.setAttribute('aria-expanded','false'));
        // apri/chiudi la corrente
        sec.setAttribute('aria-expanded', String(willOpen));
        if(willOpen) sec.scrollIntoView({behavior:'smooth',block:'start'});
      });
      h.addEventListener('keydown', e=>{
        if(e.key==='Enter' || e.key===' '){
          e.preventDefault(); h.click();
        }
      });
    });
    // Click su nav: apre solo la sezione scelta (le altre si chiudono)
    $$('nav a[data-open]').forEach(a=>{
      a.addEventListener('click', e=>{
        e.preventDefault();
        const id=a.dataset.open;
        $$('.acc').forEach(s=>s.setAttribute('aria-expanded','false'));
        setSectionOpen(id, true);
        history.replaceState(null,'',`#${id}`);
      });
    });
    // Apri da hash se presente
    if(location.hash){
      const id = location.hash.replace('#','');
      if (document.getElementById(id)?.classList.contains('acc')){
        setSectionOpen(id, true);
      }
    }

    /* ====== RICERCA/FILTRI EVENTI ====== */
    const cards = $('#event-cards');
    const recWrap = $('#recurring-cards');

    (function(){ 
      const months = [...new Set(eventi.map(e =>
        new Date(e.dateISO).toLocaleString('de-DE',{month:'long',year:'numeric'})
      ))];
      const sel=$('#month'); months.forEach(m=>{const o=document.createElement('option');o.textContent=m;o.value=m;sel.appendChild(o);});
      $('#clr').addEventListener('click', ()=>{ $('#q').value=''; $('#month').value=''; filter(); });
    })();

    function cardHTML(ev){
      return `
      <article class="card">
        <img src="${encodeURI(ev.cover)}" alt="${ev.name}" loading="lazy" decoding="async">
        <div class="content">
          <div class="pill">${ev.shortDate}</div>
          <h3>${ev.name}</h3>
          <p class="muted">${ev.desc ?? ''}</p>
          <p class="muted" style="font-size:12px">${new Date(ev.dateISO).toLocaleString('de-DE',{weekday:'short',hour:'2-digit',minute:'2-digit'})}</p>
          <div style="margin-top:8px;display:flex;gap:8px;flex-wrap:wrap">
            <a class="btn event-detail-link" href="#evento/${ev.slug}" data-slug="${ev.slug}" aria-label="Details zu ${ev.name}">Details & Reservieren</a>
            ${ev.ticketUrl ? `<a class="btn ghost" href="${ev.ticketUrl}" target="_blank" rel="noopener" aria-label="Tickets für ${ev.name} kaufen">Tickets</a>` : ``}
          </div>
        </div>
      </article>`;
    }

    const now = new Date();
    const upcoming = eventi.filter(e => new Date(e.dateISO) > now).sort((a,b)=>new Date(a.dateISO)-new Date(b.dateISO));

    function render(list){
      cards.innerHTML = list.length ? list.map(cardHTML).join('') : `<p class="muted">Keine geplanten Events mit Datum.</p>`;
    }
    render(upcoming);

    recWrap.innerHTML = recurring.map(ev => `
      <article class="card">
        ${ev.cover ? `<img src="${encodeURI(ev.cover)}" alt="${ev.name}" loading="lazy">` : ``}
        <div class="content">
          <div class="pill">${ev.when} • ${ev.time}</div>
          <h3>${ev.name}</h3>
          <p class="muted">${ev.desc ?? ''}</p>
          <div style="margin-top:8px">
            <a class="btn recurring-detail-link" href="#evento/${ev.slug}" data-slug="${ev.slug}" aria-label="Details zu ${ev.name}">Details & Reservieren</a>
          </div>
        </div>
      </article>
    `).join('');

    function filter(){
      const q=$('#q').value.toLowerCase().trim();
      const m=$('#month').value;
      const list = upcoming.filter(e=>{
        const mm=new Date(e.dateISO).toLocaleString('de-DE',{month:'long',year:'numeric'});
        const txt=(e.name+' '+(e.desc||'')+' '+(e.lineup||'')).toLowerCase();
        return (!q||txt.includes(q)) && (!m||m===mm);
      });
      render(list);
    }
    $('#q').addEventListener('input', filter);
    $('#month').addEventListener('change', filter);

    /* ====== COUNTDOWN ====== */
    (function(){
      const cdWrap = document.getElementById('countdown');
      if (!upcoming.length) return;
      const target = new Date(upcoming[0].dateISO).getTime();
      const dEl = document.getElementById('cd-d'), hEl=document.getElementById('cd-h'), mEl=document.getElementById('cd-m'), sEl=document.getElementById('cd-s');
      const tick=()=>{
        const t = target - Date.now();
        if (t<=0){dEl.textContent='0';hEl.textContent='00';mEl.textContent='00';sEl.textContent='00';return;}
        const d=Math.floor(t/86400000), h=Math.floor((t%86400000)/3600000),
              m=Math.floor((t%3600000)/60000), s=Math.floor((t%60000)/1000);
        dEl.textContent=d; hEl.textContent=String(h).padStart(2,'0');
        mEl.textContent=String(m).padStart(2,'0'); sEl.textContent=String(s).padStart(2,'0');
      }; tick(); setInterval(tick,1000); cdWrap.hidden=false;
    })();

    /* ====== MODAL EVENTI ====== */
    let currentDetailSlug = null;
    const overlayDetail = document.getElementById('event-detail');

    const findAny = slug =>
      upcoming.find(e=>e.slug===slug) ||
      eventi.find(e=>e.slug===slug)   ||
      recurring.find(e=>e.slug===slug);

    const fillDetail = ev => {
      document.getElementById('detail-title').textContent = ev.name;
      document.getElementById('detail-name').textContent  = ev.name;
      document.getElementById('detail-date').textContent  = ev.dateISO
        ? new Date(ev.dateISO).toLocaleString('it-IT',{weekday:'long',day:'2-digit',month:'long',hour:'2-digit',minute:'2-digit'})
        : `${ev.when} • ${ev.time}`;
      document.getElementById('detail-desc').textContent   = ev.desc || '—';
      document.getElementById('detail-lineup').textContent = ev.lineup || '—';
      document.getElementById('detail-prices').textContent = ev.prices || '—';
      document.getElementById('detail-cover').style.backgroundImage = ev.cover ? `url(${encodeURI(ev.cover)})` : '';
    };

    function openDetail(slug){
      const ev = findAny(slug);
      if (!ev) return;
      currentDetailSlug = slug;
      fillDetail(ev);
      overlayDetail.classList.add('show');
    }
    function closeDetail(){ overlayDetail.classList.remove('show'); }

    document.addEventListener('click', e=>{
      const a = e.target.closest('.event-detail-link, .recurring-detail-link');
      if(a){ e.preventDefault(); openDetail(a.getAttribute('data-slug')); }
      if(e.target===overlayDetail) closeDetail();
    });
    window.addEventListener('keydown', e=>{ if(e.key==='Escape') closeDetail(); });

    // Deep-link: #evento/slug
    function handleHash(){
      if(location.hash.startsWith('#evento/')){
        const slug = location.hash.split('/')[1]; if(slug) openDetail(slug);
      }
    }
    handleHash();
    window.addEventListener('hashchange', handleHash);

    /* ====== PRENOTAZIONI (solo dal pulsante nelle card) ====== */
    const overlayRes = document.getElementById('prenotazioni');

    function ensureEventSelectOptions(){
      const sel = document.getElementById('pr-event');
      if (!sel || sel.dataset.filled==='1') return;
      const list = [...upcoming.map(e=>e.name), ...recurring.map(e=>e.name+' (wiederkehrend)')];
      (list.length?list:['Karaoke Night (wiederkehrend)']).forEach(n=>{
        const o=document.createElement('option'); o.value=n; o.textContent=n; sel.appendChild(o);
      });
      sel.dataset.filled='1';
    }

    function openBooking(slug){
      ensureEventSelectOptions();
      const ev = slug ? findAny(slug) : null;
      const sel = document.getElementById('pr-event');
      const dateInput = document.getElementById('pr-data');

      if (sel){
        if (ev){ sel.value = ev.dateISO ? ev.name : `${ev.name} (wiederkehrend)`; }
        else { sel.value = ''; }
      }
      if (dateInput){
        if (ev && ev.dateISO){
          const d = new Date(ev.dateISO);
          const yyyy=d.getFullYear(), mm=String(d.getMonth()+1).padStart(2,'0'), dd=String(d.getDate()).padStart(2,'0');
          dateInput.value = `${yyyy}-${mm}-${dd}`;
        } else { dateInput.value = ''; }
      }
      overlayRes.classList.add('show');
    }
    function closeBooking(){ overlayRes.classList.remove('show'); }

    // Pulsante nel modal eventi
    document.getElementById('open-booking').addEventListener('click', ()=>{
      if (!currentDetailSlug) return;
      closeDetail();
      openBooking(currentDetailSlug);
    });

    // Click fuori chiude prenotazioni
    overlayRes.addEventListener('click', e=>{ if(e.target===overlayRes) closeBooking(); });
    window.addEventListener('keydown', e=>{ if(e.key==='Escape') closeBooking(); });

    // Validazione + salvataggio auto + invii
    function isValid(){
      const n=document.getElementById('pr-nome').value.trim();
      const t=document.getElementById('pr-tel').value.trim();
      if(!n||!t){ alert('Bitte Name und Telefon angeben.'); return false; }
      return true;
    }
    ['pr-nome','pr-tel','pr-email'].forEach(id=>{
      const el=document.getElementById(id);
      el.value = localStorage.getItem(id)||'';
      el.addEventListener('change',()=>localStorage.setItem(id,el.value));
    });

    function buildMsg(){
      const nome = document.getElementById('pr-nome').value.trim();
      const tel  = document.getElementById('pr-tel').value.trim();
      const mail = document.getElementById('pr-email').value.trim();
      const data = document.getElementById('pr-data').value;
      const evento = document.getElementById('pr-event').value;
      const lounge = document.getElementById('pr-lounge').value;
      const persone= document.getElementById('pr-persone').value;
      const note   = document.getElementById('pr-note').value.trim();
      return [
        'Hi Afterlux! Ich möchte eine Lounge reservieren.',
        evento ? `Event: ${evento}` : 'Event: (noch offen)',
        data ? `Datum: ${data}` : null,
        `Lounge: ${lounge}`, `Personen: ${persone}`,
        nome ? `Name: ${nome}` : null, tel ? `Telefon: ${tel}` : null, mail ? `E-Mail: ${mail}` : null,
        note ? `Notizen: ${note}` : null
      ].filter(Boolean).join('\n');
    }
    document.getElementById('btn-wa')?.addEventListener('click', ()=>{
      if(!isValid()) return;
      window.open(`https://wa.me/4915738465393?text=${encodeURIComponent(buildMsg())}`,'_blank');
    });
    document.getElementById('btn-mail')?.addEventListener('click', ()=>{
      if(!isValid()) return;
      location.href = `mailto:afterlux.loerrach@gmail.com?subject=${encodeURIComponent('Lounge-Reservierung - Afterlux')}&body=${encodeURIComponent(buildMsg())}`;
    });
  </script>
</body>
</html>
